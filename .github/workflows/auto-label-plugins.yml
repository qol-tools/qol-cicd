name: Auto-label qol-tray plugins

on:
  workflow_dispatch:
    inputs:
      repo_name:
        description: 'Repository name (e.g., plugin-window-actions)'
        required: false
  schedule:
    - cron: '0 0 * * *'

jobs:
  label-plugin:
    runs-on: ubuntu-latest
    steps:
      - name: Find and label plugin repos
        env:
          GH_TOKEN: ${{ secrets.ORG_PAT }}
        run: |
          ORG="qol-tools"
          TOPIC="qol-tray-plugin"

          if [ -n "${{ github.event.inputs.repo_name }}" ]; then
            REPOS="${{ github.event.inputs.repo_name }}"
          else
            REPOS=$(gh repo list "$ORG" --limit 1000 --json name --jq '.[] | select(.name | startswith("plugin-")) | .name')
          fi

          for REPO in $REPOS; do
            echo "Adding topic '$TOPIC' to $ORG/$REPO"
            gh repo edit "$ORG/$REPO" --add-topic "$TOPIC" || echo "Failed to add topic to $REPO"
          done

